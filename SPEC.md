# 技術規格文件 (SPEC) - 快樂署北PA假日抽籤許願系統

## 1. 專案概覽

「快樂署北PA假日抽籤許願系統」是一個專為小型團隊設計的網頁應用程式，旨在簡化和公平化連續假期的排班流程。系統提供兩種不同的排班模式，以應對不同性質的假期需求：一種是基於權重優先級的申請模式，另一種是結合自願登記與隨機抽籤的特殊模式。所有資料皆透過 Cloudflare KV 雲端儲存，實現跨裝置同步。

## 2. 核心功能

### 2.1. 團隊成員管理

-   **新增成員**: 使用者可以輸入姓名來新增團隊成員。
-   **移除成員**: 可以從列表中移除現有成員。
-   **資料連動**: 移除成員時，系統會自動清除該成員在所有假期中的申請記錄與排班資料。

### 2.2. 假期管理

-   **新增假期**:
    -   可自訂假期名稱、開始日期、結束日期。
    -   可設定該假期的總可用名額。
    -   可選擇該假期的排班模式：「一般權重模式」或「春節特殊抽籤模式」。
    -   **日期選擇優化**: 選擇起始日期後，結束日期的日曆將無法選擇比起始日更早的日期。
-   **編輯假期細節**:
    -   在假期詳情視圖中，使用者可以點擊編輯按鈕，直接修改該假期的**開始日期**、**結束日期**和**可用名額**。
-   **移除假期**: 可從列表中刪除已建立的假期。
-   **檢視假期**: 點擊列表中的任一假期，可在右側主面板查看其詳細資訊與排班狀況。
-   **拖曳排序**: 使用者可以透過拖曳自由調整假期在列表中的顯示順序。

### 2.3. 一般權重模式

-   **權重申請**: 團隊成員針對假期提交申請時，需附帶一個「權重排名」。
-   **權重邏輯**: **數字越小，優先級越高**。系統會依權重排名數字由小到大排序所有申請者。
-   **權重上限**: 「全域設定」中的「預設權重」值同時作為成員可選權重的上限。
-   **年度權重唯一性**:
    -   每位成員在**同一個日曆年度**內，每種權重數字**只能使用一次**。
    -   UI 強制執行此規則：在申請介面中，下拉選單僅會顯示該成員於該年度尚未使用的權重。
-   **編輯權重**: 使用者可以對已提交的申請進行編輯，為其重新選擇一個該年度可用的權重。
-   **狀態顯示**: 根據假期設定的「可用名額」，系統會自動將排序在前的申請者標示為「**已批准**」，超出名額者則標示為「**候補**」。

### 2.4. 春節特殊抽籤模式

-   **每日排班視圖**: 介面會以列表形式展示該假期的每一天。
-   **自訂每日備註**:
    -   系統在建立假期時會自動生成預設備註（如：除夕、初一...）。
    -   使用者可以點擊備註旁的編輯圖示，**自由修改每一天的備註文字**。
-   **自願登記**:
    -   尚未排班的成員可以選擇任一「待安排」的日期進行自願登記。
    -   每位成員在同一個春節假期中，只能被指派（自願或抽籤）一天。
-   **隨機抽籤**:
    -   當存在「待安排」的日期且有尚未排班的成員時，管理者可點擊「執行抽籤」。
    -   系統會從尚未排班的成員中隨機抽取，填滿所有剩餘的空缺日期。
-   **結果清除**: 管理者可以「清除抽籤」結果，此操作**只會移除抽籤產生的排班**，所有成員的「自願」登記將被保留。
-   **狀態顯示**: 每一天的排班結果會明確標示為「**自願**」或「**抽籤**」。

### 2.5. 全域設定

-   **預設權重與上限**: 提供一個「預設權重」的設定欄位，此設定同時作為新申請的預設值以及所有成員可選權重的**上限**。
-   **自動分配假期**:
    -   提供「**自動分配剩餘假期**」按鈕。
    -   點擊後，系統會反覆運算，將剩餘名額逐一分配給**當下年度休假最少的成員**，直到所有空位被填滿。
    -   分配時會自動使用該成員可用的**最低優先級權重**（即數字最大的權重），以保留其高價值權重。

### 2.6. 年度假期總覽

-   **成員視角總覽**: 在頁面底部提供一個總覽區塊，以每位成員為單位，顯示其排班狀況。
-   **詳細資訊**: 每位成員的卡片上會顯示：
    -   姓名。
    -   已批准的假期總數。
    -   所有已批准假期的詳細列表（假期名稱與日期）。
-   **即時更新**: 總覽區的資訊會根據上方的任何操作自動即時更新。

## 3. 技術規格

-   **前端框架**: React.js
-   **語言**: TypeScript
-   **樣式**: Tailwind CSS (透過 CDN 載入)
-   **後端**: Cloudflare Functions
-   **狀態管理**: 使用 React 內建的 Hooks (`useState`, `useCallback`, `useMemo`, `useEffect`) 進行狀態管理。
-   **資料持久化**: 使用 **Cloudflare Workers KV**。所有資料皆儲存在雲端，可實現跨裝置和瀏覽器同步。前端應用程式透過 API (`/api/data`) 與後端進行通訊。